<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style type="text/css">
	body {
	   margin: 0;
	   padding: 0;
	}
	#video::cue {
	    background-color: transparent;
	    color: #FFF;
	    font-size: 32px;
	    font-family: "Lobster", cursive;
	    margin-top: 0px;
	    top: 0px;
	    margin-bottom: 500px;
	    line-height: 1;
	}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body style="background-color: black;">
	<div id="targettrackWrap" style="text-align: center; height: 45px; position: relative;">
		<span id="targettrack" style="color: white;"></span><span>ã‚‰</span>
		<span id="time" style="color: white; position: absolute; right: 0px; bottom:0px;">0/24</span>
	</div>
	<div style="display: flex; flex-direction: column; height: calc(100vh - 45px); width: 100%; overflow: hidden;">
		<video id="video" width="100%" style="">
		    <source id="video_source" src="" type="video/mp4">
		    <track id="video_track" label="japanese" kind="subtitles" src="" srclang="ja" default>
		</video>
		<div style="position: relative; z-index: 0; overflow: hidden; flex-grow: 1">
			<iframe src="https://jisho.org/" id="iframe"  style="position: absolute; top: -63px; left: 0px; z-index: 1; width: 100%; height: calc(100% + 63px); overflow: visible;">
			</iframe>
		</div>
	</div>
	
	<script type="text/javascript">
	$(function () {
		function copyTextToClipboard(text) {
		  var textArea = document.createElement("textarea");
		  // Place in top-left corner of screen regardless of scroll position.
		  textArea.style.position = 'fixed';
		  textArea.style.top = 0;
		  textArea.style.left = 0;
		  // Ensure it has a small width and height. Setting to 1px / 1em
		  // doesn't work as this gives a negative w/h on some browsers.
		  textArea.style.width = '2em';
		  textArea.style.height = '2em';
		  // We don't need padding, reducing the size if it does flash render.
		  textArea.style.padding = 0;
		  // Clean up any borders.
		  textArea.style.border = 'none';
		  textArea.style.outline = 'none';
		  textArea.style.boxShadow = 'none';
		  // Avoid flash of white box if rendered for any reason.
		  textArea.style.background = 'transparent';
		  textArea.value = text;
		  document.body.appendChild(textArea);
		  textArea.focus();
		  textArea.select();
		  try {
		    var successful = document.execCommand('copy');
		    var msg = successful ? 'successful' : 'unsuccessful';
		    console.log('Copying text command was ' + msg);
		  } catch (err) {
		    console.log('Oops, unable to copy');
		  }
		  document.body.removeChild(textArea);
		}
		var links = [
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_166462011720811_4775204481540438594_n.mp4?_nc_cat=103&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=3RTxCBghXAYAX_P-FlT&_nc_ht=scontent.fdad2-1.fna&oh=57779bf7c990603313df9559c97257fd&oe=5F9497DB',
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_362102924790685_59011847993419913_n.mp4?_nc_cat=101&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=qhk7FTxXP0kAX9W6I_2&_nc_ht=scontent.fdad2-1.fna&oh=62fdc3d862d1dc66d7195da6de7612a0&oe=5F9457F2',
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_1441446916245000_1721547938743027959_n.mp4?_nc_cat=103&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=o8_tR8ERqB4AX_RZRFW&_nc_ht=scontent.fdad2-1.fna&oh=3fcb759d3ea2749bc7bc44db31936876&oe=5F95A60A',
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_362017321625372_6027757880005122740_n.mp4?_nc_cat=103&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=l7YXW5A4hH0AX_I4YgH&_nc_ht=scontent.fdad2-1.fna&oh=8455614daee802a09f3858ede26d838c&oe=5F95C794',
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_751463102362576_409645879667511296_n.mp4?_nc_cat=111&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=ec4fbj8Z91QAX-JxaRQ&_nc_ht=scontent.fdad2-1.fna&oh=592dd2aedf6d8ef71fb3244f99373a02&oe=5F9768C4',
		'https://scontent.fdad2-1.fna.fbcdn.net/v/t66.36240-6/10000000_401956264119971_7719799930281527130_n.mp4?_nc_cat=111&_nc_sid=985c63&efg=eyJ2ZW5jb2RlX3RhZyI6Im9lcF9oZCJ9&_nc_ohc=8PJxMPS6PKYAX8kj5L0&_nc_oc=AQmIi5iEWI0RwU7mrbUjM0gLOCo3o4BUxkkvUFpSXLqirgU3G73rss8T39b8W8i145E&_nc_ht=scontent.fdad2-1.fna&oh=99bf5eb4f1b8c6b05e714db9b60dae58&oe=5F968D99'
		];
		var tracks = [
			'[SubtitleTools.com] Clannad_001.vtt',
			'[SubtitleTools.com] Clannad_002.vtt',
			'[SubtitleTools.com] Clannad_003.vtt',
			'[SubtitleTools.com] Clannad_004.vtt',
			'[SubtitleTools.com] Clannad_005.vtt',
			'[SubtitleTools.com] Clannad_006.vtt',
		];
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const episode = urlParams.get('episode');
		var iframe = $('#iframe');
		var targettrackWrap = $('#targettrackWrap');
		var video = $('#video');
		var time = $('#time');
		var videoSource = $('#video_source');
		videoSource.attr('src', links[episode - 1]);
		var videoTrack = $('#video_track');
		var activeCues = null;
		// var track = videoTrack[0];
		videoTrack.attr('src', tracks[episode - 1]);
		// track.activeCues[0].line = 0;
		video[0].load();
		const textTracks = video[0].textTracks; // one for each track 
		textTrack = textTracks[0];
		var targettrack = $('#targettrack');
		textTrack.mode = 'hidden';
		textTrack.oncuechange = function () {
			activeCues = this.activeCues[0];
			if (activeCues) {
				targettrack.html(activeCues.text);
			} else {
				targettrack.html('');
			}
		}
		video[0].onpause = function() {
			setTimeout(function(){
				if (activeCues) {
	  				copyTextToClipboard(activeCues.text);
			    	iframe.attr('src', 'https://jisho.org/search/' + activeCues.text);
				}
			}, 50);
		};

		video.on("click", function(e){
    	  var rect = e.target.getBoundingClientRect();
		  var x = e.clientX - rect.left; //x position within the element.
		  var y = e.clientY - rect.top;  //y position within the element.
		  var width =  Math.floor(rect.width);
		  if (x >= 0 && x < Math.floor(width/3)) {
	         video[0].currentTime = video[0].currentTime - 5;
		  } else if (x >= Math.floor(width/3) && x <= Math.floor((width/3)*2)) {
        	if (video[0].paused){
            	video[0].play();
        	} else {
            	video[0].pause();
        	}
		  } else {
	         video[0].currentTime = video[0].currentTime + 5;
		  }
	    });
		targettrackWrap.on("click", function(e){
    	  var rect = e.currentTarget.getBoundingClientRect();
		  var x = e.clientX - rect.left; //x position within the element.
		  var y = e.clientY - rect.top;  //y position within the element.
		 	video[0].currentTime = Math.floor(x * video[0].duration / rect.width);
	    });
	    var currentTimeOld = 0;
		video[0].ontimeupdate = function() {
			var currentTime = Math.floor(video[0].currentTime);
			var duration = Math.floor(video[0].duration);
			if (currentTimeOld != currentTime) {
				time.text((Math.floor(currentTime/60)) + ':' + (currentTime%60) + '/' + (Math.floor(duration/60)) + ':' + (duration%60));
				currentTimeOld = currentTime;
			}
		};
		// iframe.attr('height', window.innerHeight - $("#video")[0].getBoundingClientRect().bottom);
	});
</script>
</body>
</html>
